# Project Rules

> This file is the **source of truth** for AI rules in this repo. In IDEs like Windsurf, copy the relevant parts of this file into **Customizations â†’ Rules â†’ Workspace** so Cascade follows them for this workspace.

## Spec Kit Integration

This project uses Spec Kit for Spec-Driven Development. The methodology separates:
- **Constitution**: Project principles, rules, and constraints that apply to ALL features
- **Specification**: What a specific feature does and why (business view)
- **Plan**: How a feature will be implemented technically

Specifications are **living artifacts**: expect to revisit the same feature across multiple `/speckit-specify` runs (and `/speckit-clarify` sessions) until it is ready for planning.

### Available Commands

| Command | Purpose |
|---------|---------|
| `/speckit-context` | Initializes/updates `project-context/` (creates `project-workplan.md` + `project-overview.md`, env vars, database schema, tools, agents) |
| `/speckit-constitution` | Creates/updates project principles and rules. At project start, capture **minimum rails** (stack, compliance, non-negotiable rules) before specifying features |
| `/speckit-specify` | Creates/updates feature specifications (WHAT and WHY, no technical details) through iterative runs and keeps workplan/overview in sync as specs evolve |
| `/speckit-triage` | **Optional.** For broad/mixed input (voice, docs, brain dump). Routes content to Constitution vs Specification backlogs and also updates workplan/overview when used |
| `/speckit-plan` | Creates technical implementation plans (HOW) |
| `/speckit-tasks` | Breaks plans into actionable tasks |
| `/speckit-implement` | Executes implementation following the plan |
| `/speckit-clarify` | Asks structured questions to de-risk ambiguous areas |
| `/speckit-analyze` | Cross-artifact consistency report |
| `/speckit-checklist` | Generates quality checklists |

Typical starting points:
- **New project** â†’ `/speckit-context` â†’ `/speckit-constitution` (minimal rails: stack + fixed rules) â†’ `/speckit-specify` for the first feature.
- **New feature in a project that already has a constitution** â†’ `/speckit-specify` directly.
- **Chaotic, long or legacy input (voice, large doc, many mixed ideas)** â†’ `/speckit-context` â†’ `/speckit-triage` in N rounds â†’ then `/speckit-constitution` and `/speckit-specify` absorb the backlogs.

## Visual Modeling Requirements

This project requires Mermaid diagrams in all artifacts:

### In Specifications (spec.md):
- Process Flow (flowchart TD) - user journey in business language
- Agent Collaboration (if multi-agent) - data flow between agents
- Insights section with gaps, opportunities, and risks

### In Plans (plan.md):
- System Interaction Diagram (sequenceDiagram) - technical component interactions
- Component Architecture (flowchart TB) - system structure
- Agent Contracts table (if multi-agent)

### Gap Visualization
- Use `[?]` suffix for unclear steps
- Apply red/orange styling for incomplete areas
- Include gap summary box in complex diagrams
- See `.specify/docs/flows/gap-notation.md` for standards

### Global Project Mindmap (Optional)

For a **single-page global view** of the project, you MAY use Mermaid `mindmap` syntax:

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryTextColor': '#000', 'secondaryTextColor': '#000', 'tertiaryTextColor': '#000', 'lineColor': '#333'}}}%%
mindmap
  root((Project: PROJECT_NAME))
    Business
      Vision
      Value propositions
      KPIs
    Users
      Primary personas
      Secondary personas
    Capabilities
      Core flows
      Supporting flows
    Technical
      Architecture style
      Integrations
      Constraints
    Risks & Gaps
      Open questions
      Assumptions
      Dependencies
```

Use this mindmap together with `project-overview.md` to keep a consistent global mental model of the system.

## Project Context

Before generating plans or implementations, read project context from `project-context/`:
- `project-workplan.md` - **ðŸŽ¯ ORCHESTRATION (read first)** - Which agent to call next
- `project-overview.md` - **ðŸŽ¯ MACRO VIEW** - Project status and gaps
- `env-vars.md` - Available environment variables
- `database-schema.md` - Database structure and field meanings
- `tools-registry.md` - Available MCPs and integrations
- `agent-framework.md` - Agent architecture (if applicable)
- `folder-structure.md` - Project organization

If `project-context/` doesn't exist, suggest running `/speckit-context` first to initialize the project.

## Project Lifecycle Flow

The project evolves progressively (Macro â†’ Micro):

### Project Start Sequence (for new projects)

**Default conversational flow (recommended)**

1. **Step 0**: Run `/speckit-context` â†’ Creates `project-workplan.md` + `project-overview.md`
2. **Step 1**: Run `/speckit-constitution` â†’ Register a minimal constitution with stack, compliance and non-negotiable rules
3. **Step 2**: Discuss the first feature and run `/speckit-specify` â†’ Creates the first `spec.md` and updates overview/workplan
4. **Step 3**: Use `/speckit-clarify` if needed â†’ Resolves important gaps in the specification
5. **Step 4**: Run `/speckit-plan` â†’ Technical design for the feature
6. **Step 5**: Run `/speckit-tasks` â†’ Break into tasks
7. **Step 6**: Run `/speckit-implement` â†’ Execute

**Optional flow with big dump / legacy input (with `/speckit-triage`)**

1. **Step A0**: Run `/speckit-context` â†’ Creates `project-workplan.md` + `project-overview.md`
2. **Step A1**: Run `/speckit-triage` (first round) â†’ Capture initial scope from mixed input
3. **Step A2**: Continue `/speckit-triage` (N rounds) â†’ Refine until macro view is stable
4. **Step A3**: Decision Point DP1 â†’ Define project structure
5. **Step A4**: Run `/speckit-constitution` â†’ Consolidate principles from triage backlog
6. **Step A5**: Run `/speckit-specify` â†’ Create feature specs (absorbing entries from `triage_specification.md`)
7. **Step A6**: Run `/speckit-plan` â†’ Technical design
8. **Step A7**: Run `/speckit-tasks` â†’ Break into tasks
9. **Step A8**: Run `/speckit-implement` â†’ Execute

### Multi-Round Discovery and Specification

When you choose the triage-based flow, `/speckit-triage` is designed for **N interactions**, not one-shot:
- Round 1: Initial vision, objective, product type
- Round 2..N: Progressively refine personas, use cases, constraints
- Exit when: Macro view stable, constitution backlog clear, at least one feature ready to specify

**Iterative specification**:
- `/speckit-specify` is also naturally multi-round.
- When triage is used, it absorbs entries from `triage_specification.md` across multiple runs.
- When triage is **not** used, it iterates directly on the same `spec.md` via conversation and repeated `/speckit-specify` + `/speckit-clarify` calls.

### Decision Points

| ID | Decision | When | Output |
|----|----------|------|--------|
| DP1 | Project Structure | After triage stabilizes | `folder-structure.md` |
| DP2 | Tech Stack | During constitution | `constitution.md` |

### Rules

- Always read `project-workplan.md` to know which agent to call next
- Always read `project-overview.md` to understand the current state
- After any significant change, update both workplan and overview
- Identified gaps must be visible in the macro diagram
- Version the overview (V1, V2, V3...) as it evolves

## Communication Style

- User may not be a developer - explain technical concepts when needed
- Provide complete commands ready to execute
- Explain the purpose before taking actions
- Use simple, clear language
- Prefer established, well-documented libraries and patterns

### New Chat / Session Ritual

- On every new chat in this workspace, first clarify the main subject or feature for the session (for example: context, constitution, specify, plan, implement, debug, or mixed/triage).
- Before proposing actions, read `Project Rules` (this file) and, when available, `project-context/project-workplan.md` and `project-context/project-overview.md` to recover the current project state.
- If the chat is about an existing feature, also read the relevant `spec.md` and `plan.md` files before deep technical work.
- Start the conversation with a short recap (3â€“5 bullets) of the current state for that subject and a recommended next step.
- Explicitly ask the user to confirm or adjust the objective of the current session (for example: clarify, specify, plan, implement, review).
- Treat chat history as transient; persist important decisions and state changes in the appropriate artifacts (`project-context/`, specs, plans, and constitution), not only in conversation.

## Stack Consistency

- Respect technology choices defined in plan.md
- Don't suggest alternative stacks without explicit request
- Honor existing .env and MCP configurations

## Iterative Completeness (Golden Rule)

At the end of EVERY phase, deliverable, or significant output, always ask:

```
ðŸ”„ Need another round?
- What's missing?
- What needs clarification?
- What should be added?
```

- This is MANDATORY before closing any phase
- Never assume the output is complete without user validation
- Iterate until user explicitly confirms satisfaction

## Source of Truth

- **Project Rules**: `Project Rules` (this file) - primary AI rules for this repository; read FIRST before any work
- **Constitution**: `.specify/memory/constitution.md` - project-level principles and constraints; read soon after Project Rules when working inside this project or updating methodology
- **Methodology**: `.specify/docs/sdp-pdca.md` - Spec-Driven PDCA cycle (PLAN â†’ DO â†’ CHECK â†’ ACT)
- **Memory System**: `.specify/docs/memory-system.md` - Continuous state management and update protocols
- **Project Context**: `project-context/` - project-specific technical documentation
- **Documentation**: `.specify/docs/` - visual flows and methodology guides
- **Templates**: `.specify/templates/` - artifact templates

### Key Methodology Documents

For deep understanding of the process:
- **SDP-PDCA**: Complete PDCA adaptation for spec-driven development
  - PLAN: Context â†’ (Optional: Triage) â†’ Constitution â†’ Specify â†’ Clarify â†’ Design
  - DO: Tasks â†’ Implementation (5 phases: Setup, Tests, Core, Integration, Polish)
  - CHECK: 6-level validation (artifacts, quality, tests, acceptance, constitution, user)
  - ACT: Categorized refinement + knowledge capture in artifact versions
  
- **Memory System**: How project state is maintained

### Specification Techniques

- **Concept Model Simulation**: `.specify/docs/concept-model-simulation.md`
  - Technique for validating concept models (entities, relations, properties) via practical simulation in a sandbox database
  - Use during `/speckit-specify` when the feature requires complex data structure modeling (graphs, ontologies, dense relational schemas)
  - Competency questions drive the structure; each approved validation becomes project context/spec
  - Outputs: schema-spec, ingestion-spec, query-spec, test-spec
